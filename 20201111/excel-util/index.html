<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联） | 子晋的博客</title><meta name="keywords" content="excel导出,excel下拉框,下拉级联,多选下拉excel"><meta name="author" content="子晋"><meta name="copyright" content="子晋"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="实现excel带下拉框导出模板，适配多种情况，配置简单灵活">
<meta property="og:type" content="article">
<meta property="og:title" content="工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）">
<meta property="og:url" content="http://blog.leezijin.com/20201111/excel-util/index.html">
<meta property="og:site_name" content="子晋的博客">
<meta property="og:description" content="实现excel带下拉框导出模板，适配多种情况，配置简单灵活">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://blog.leezijin.com/img/blog_excel-util.jpg">
<meta property="article:published_time" content="2020-11-11T07:30:11.000Z">
<meta property="article:modified_time" content="2020-11-11T09:17:46.275Z">
<meta property="article:author" content="子晋">
<meta property="article:tag" content="工具类">
<meta property="article:tag" content="excel">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.leezijin.com/img/blog_excel-util.jpg"><link rel="shortcut icon" href="/img/author.png"><link rel="canonical" href="http://blog.leezijin.com/20201111/excel-util/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//s4.cnzz.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script async="async" data-pjax="data-pjax" src="https://s4.cnzz.com/z_stat.php?id=1279397347&amp;web_id=1279397347"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 子晋","link":"链接: ","source":"来源: 子晋的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-11 17:17:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="/img/author.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 说说</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我的</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/blog_excel-util.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">子晋的博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 说说</span></a></li><li><a class="site-page" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我的</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-11T07:30:11.000Z" title="发表于 2020-11-11 15:30:11">2020-11-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-11T09:17:46.275Z" title="更新于 2020-11-11 17:17:46">2020-11-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/vb/">vb</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>项目新需求，要求导出excel模板时，某些字段限制手动输入，只能下拉选择数据，并且可以多字段级联选择、多选。于是，借鉴了些大佬的操作，东拼西凑总算将要用到的功能整合到一起了。废话不多说，直接撸代码。</p>
<h1 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h1><h2 id="先来个配置类自定义注解"><a href="#先来个配置类自定义注解" class="headerlink" title="先来个配置类自定义注解"></a>先来个配置类自定义注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>  </span><br><span class="line"><span class="meta">@Target( &#123; java.lang.annotation.ElementType.FIELD &#125;)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ExcelAnnotation &#123;</span><br><span class="line">	 <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 导出到Excel中的名字. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">name</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 配置列号,对应0，1，2，3.... </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">column</span><span class="params">()</span></span>;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 该字段是否导出 默认true</span></span><br><span class="line"><span class="comment">     */</span>   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isExport</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 表头批注 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">prompt</span><span class="params">()</span>  <span class="keyword">default</span> &quot;&quot;</span>;    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 是否是下拉框</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isCombo</span><span class="params">()</span>  <span class="keyword">default</span> <span class="keyword">false</span></span>;    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 父字段列号（下拉框联动）</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">parentFieldColumn</span><span class="params">()</span>  <span class="keyword">default</span> 0</span>;    </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 下拉框数据</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">comboValue</span><span class="params">()</span>  <span class="keyword">default</span> &quot;&quot;</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将该注解配置到具体实现类上用来配置导出信息，包括导出的字段、字段顺序、表头批注等等，具体使用如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileExportVo</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档路径&quot;,column=0)</span></span><br><span class="line">	<span class="keyword">private</span> String filepath;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档版本&quot;,column=1,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String fileversion;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档描述&quot;,column=2)</span></span><br><span class="line">	<span class="keyword">private</span> String filenote;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档属性&quot;,column=3,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String filesource;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;所属部门&quot;,column=4,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String dep;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;是否正式文档&quot;,column=5,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String fileflag;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档合规属性&quot;,column=6,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String fileproperty; </span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档类型&quot;,column=7,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String typeid;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;作者&quot;,column=8)</span></span><br><span class="line">	<span class="keyword">private</span> String author;</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档语言&quot;,column=9,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String filelang;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;适用OS版本&quot;,column=10,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String androidversion;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档关键字&quot;,column=11,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String keywords;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;备注&quot;,column=12,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String fileremark;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@ExcelAnnotation(name=&quot;文档适用平台&quot;,column=13,isCombo=true)</span></span><br><span class="line">	<span class="keyword">private</span> String filechips;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Excel工具类入口"><a href="#Excel工具类入口" class="headerlink" title="Excel工具类入口"></a>Excel工具类入口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(导出Excel 模板/数据（可配置下拉列表）)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Explain</span> 在实体类字段上添加ExcelAnnotation注解，配置相应信息即可使用</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> fileName 导出文件名</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> sheetName 工作簿</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> clazz 实体对象的Class</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> comboParams 参数数据 1、表头提示/下拉框待选数据；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> comboParams 参数数据 2、Map&lt;字段,Map&lt;(prompt/comboValue),Object&gt;；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> comboParams 参数数据 3、comboValue下拉框数据 直接传入对象list；prompt批注直接传入字符串信息即可；</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> values 导出数据</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> wb wb</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> response response</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> XSSFWorkbook <span class="title">getXSSFWorkbook</span><span class="params">(String fileName,String sheetName, Class&lt;?&gt; clazz,Map&lt;String,Map&lt;String,Object&gt;&gt; comboParams,List&lt;?&gt; values, XSSFWorkbook wb,HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">// 第一步，创建一个XSSFWorkbook，对应一个Excel文件</span></span><br><span class="line">	<span class="keyword">if</span> (wb == <span class="keyword">null</span>) &#123;</span><br><span class="line">		wb = <span class="keyword">new</span> XSSFWorkbook();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 第二步，在workbook中添加一个sheet,对应Excel文件中的sheet</span></span><br><span class="line">	XSSFSheet sheet = wb.getSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 第三步，在sheet中添加表头第0行,注意老版本poi对Excel的行数列数有限制</span></span><br><span class="line">	XSSFRow row = sheet.createRow(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 第四步，创建单元格，并设置值表头 设置表头居中</span></span><br><span class="line">	XSSFCellStyle style = wb.createCellStyle();</span><br><span class="line">	style.setAlignment(HSSFCellStyle.ALIGN_CENTER); <span class="comment">// 创建一个居中格式</span></span><br><span class="line">	style.setWrapText(<span class="keyword">true</span>);<span class="comment">// 自动换行</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明列对象</span></span><br><span class="line">	XSSFCell cell = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//参数数据（下拉框参数，head提示信息）</span></span><br><span class="line">	<span class="keyword">if</span>(comboParams!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(String field:comboParams.keySet()) &#123;</span><br><span class="line">			<span class="comment">//参数，类型(combo,prompt):数据</span></span><br><span class="line">			Map&lt;String,Object&gt; param=comboParams.get(field);</span><br><span class="line">			<span class="keyword">for</span>(String type:param.keySet()) &#123;</span><br><span class="line">				setClassExcelAnnotation(clazz, field, type, param.get(type));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//获取字段</span></span><br><span class="line">	Field[] fields=clazz.getDeclaredFields();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fields.length; i++) &#123;  </span><br><span class="line">		Field field = fields[i];</span><br><span class="line">		ExcelAnnotation attr = field.getAnnotation(ExcelAnnotation.class);  </span><br><span class="line">		<span class="keyword">if</span> (attr != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">boolean</span> isExport=attr.isExport();<span class="comment">//是否导出</span></span><br><span class="line">			<span class="keyword">if</span>(isExport) &#123;</span><br><span class="line">				<span class="keyword">int</span> col = attr.column();<span class="comment">// 获得列号</span></span><br><span class="line">				cell = row.createCell(col);<span class="comment">// 创建列  </span></span><br><span class="line">				cell.setCellType(HSSFCell.CELL_TYPE_STRING);<span class="comment">// 设置列中写入内容为String类型  </span></span><br><span class="line">				cell.setCellValue(attr.name());  </span><br><span class="line">				<span class="comment">// 如果设置了提示信息则鼠标放上去提示.  </span></span><br><span class="line">				<span class="keyword">if</span> (!attr.prompt().trim().equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">					setXSSFPrompt(sheet, attr.prompt(),cell); </span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// 如果设置了combo属性则本列只能选择或者输入下拉中的内容  </span></span><br><span class="line">				<span class="keyword">if</span> (attr.isCombo()) &#123;</span><br><span class="line">					setXSSFValidation(sheet,field.getName(),attr,wb);</span><br><span class="line">				&#125;  </span><br><span class="line">				cell.setCellStyle(style);  </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	 &#125;  </span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建内容</span></span><br><span class="line">	<span class="keyword">if</span>(values!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.size(); i++) &#123;</span><br><span class="line">			row = sheet.createRow(i + <span class="number">1</span>);</span><br><span class="line">			ExcelAnnotation attr =<span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; fields.length; j++) &#123;  </span><br><span class="line">				Field declaredField = fields[j];</span><br><span class="line">				attr = declaredField.getAnnotation(ExcelAnnotation.class);  </span><br><span class="line">				<span class="keyword">if</span> (attr != <span class="keyword">null</span>) &#123;</span><br><span class="line">					<span class="comment">//是否导出</span></span><br><span class="line">					<span class="keyword">boolean</span> isExport=attr.isExport();</span><br><span class="line">					<span class="keyword">if</span>(isExport) &#123;</span><br><span class="line">						<span class="comment">// 获得列号  </span></span><br><span class="line">						<span class="keyword">int</span> col = attr.column();</span><br><span class="line">						declaredField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">						<span class="comment">//获取数据</span></span><br><span class="line">						Object val;</span><br><span class="line">						String value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							val = declaredField.get(values.get(i));</span><br><span class="line">							<span class="keyword">if</span>(val!=<span class="keyword">null</span>) &#123;</span><br><span class="line">								<span class="keyword">if</span>(val.getClass().toString().equals(<span class="string">&quot;class java.util.Date&quot;</span>))&#123;</span><br><span class="line">									value=DateUtil.date2StringDate((Date)val);</span><br><span class="line">								&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">									value=val.toString();</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">						row.createCell(col).setCellValue(value);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;  </span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//导出模板 模拟50条空数据</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">			creatAppRow(sheet,i,fields);</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//响应到客户端</span></span><br><span class="line">	<span class="keyword">if</span>(response!=<span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			setResponseHeader(response, fileName);</span><br><span class="line">			OutputStream os = response.getOutputStream();</span><br><span class="line">			wb.write(os);</span><br><span class="line">			os.flush();</span><br><span class="line">			os.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> wb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加下拉数据验证"><a href="#添加下拉数据验证" class="headerlink" title="添加下拉数据验证"></a>添加下拉数据验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:设置下拉数据验证</span></span><br><span class="line"><span class="comment"> *  由于下列是不确定是所以不能保证不超过255故用隐藏页来放置下列信息</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> sheet</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> textlist</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> wb</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setXSSFValidation</span><span class="params">(XSSFSheet sheet,String fieldName,ExcelAnnotation attr, XSSFWorkbook wb)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 获取所有sheet页个数</span></span><br><span class="line">	<span class="keyword">int</span> sheetTotal = wb.getNumberOfSheets();</span><br><span class="line">	String hiddenSheetName = <span class="string">&quot;hiddenSheet&quot;</span> + sheetTotal;</span><br><span class="line">	XSSFSheet hiddenSheet = wb.createSheet(hiddenSheetName);</span><br><span class="line">	<span class="comment">//下拉数据</span></span><br><span class="line">	String comboValue=attr.comboValue();</span><br><span class="line">	Object obj=JSON.parse(comboValue);</span><br><span class="line">	Map&lt;String,Object&gt; comboValues=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line">	<span class="keyword">if</span>(obj <span class="keyword">instanceof</span> Map) &#123;</span><br><span class="line">		comboValues=(Map&lt;String,Object&gt;) obj;</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		comboValues.put(fieldName, obj);</span><br><span class="line">	&#125;</span><br><span class="line">	Row row;</span><br><span class="line">	Cell cell;</span><br><span class="line">	Name name;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (String key : comboValues.keySet()) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(i==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//创建一行</span></span><br><span class="line">			row = hiddenSheet.createRow(<span class="number">0</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//获取行</span></span><br><span class="line">			row=hiddenSheet.getRow(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//创建列</span></span><br><span class="line">		cell = row.createCell(i);</span><br><span class="line">		<span class="comment">//给列设置值</span></span><br><span class="line">		cell.setCellValue(key);</span><br><span class="line">		JSONArray jsonArray=(JSONArray) comboValues.get(key);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= jsonArray.size(); j++) &#123;</span><br><span class="line">			row=hiddenSheet.getRow(j);</span><br><span class="line">			<span class="keyword">if</span>(row==<span class="keyword">null</span>) &#123;</span><br><span class="line">				row=hiddenSheet.createRow(j);</span><br><span class="line">			&#125;</span><br><span class="line">			cell = row.getCell(i);</span><br><span class="line">			<span class="keyword">if</span>(cell==<span class="keyword">null</span>) &#123;</span><br><span class="line">				cell = row.createCell(i);</span><br><span class="line">			&#125;</span><br><span class="line">			Object ob=jsonArray.getObject(j-<span class="number">1</span>, Object.class);</span><br><span class="line">			cell.setCellValue((String)ob);</span><br><span class="line">		&#125;</span><br><span class="line">		name = wb.createName();</span><br><span class="line">		name.setNameName(key.toString());</span><br><span class="line">		name.setRefersToFormula(hiddenSheetName + <span class="string">&quot;!$&quot;</span>+getcellColumnFlag(i)+<span class="string">&quot;$2:$&quot;</span>+getcellColumnFlag(i)+<span class="string">&quot;$&quot;</span>+(jsonArray.size()+<span class="number">1</span>));</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//隐藏数据源</span></span><br><span class="line">	wb.setSheetHidden(sheetTotal, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建数据"><a href="#创建数据" class="headerlink" title="创建数据"></a>创建数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(创建数据)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> xssfSheet sheet</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> naturalRowIndex 行标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">creatAppRow</span><span class="params">(XSSFSheet xssfSheet, <span class="keyword">int</span> naturalRowIndex,Field[] fields)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//看有多少下拉框验证 添加验证数据</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fields.length; i++) &#123;  </span><br><span class="line">		Field field = fields[i];</span><br><span class="line">		ExcelAnnotation attr = field.getAnnotation(ExcelAnnotation.class);  </span><br><span class="line">		<span class="keyword">if</span> (attr != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">boolean</span> isExport=attr.isExport();<span class="comment">//是否导出</span></span><br><span class="line">			<span class="keyword">if</span>(isExport) &#123;</span><br><span class="line">				<span class="keyword">int</span> col = attr.column();<span class="comment">// 获得列号</span></span><br><span class="line">				<span class="keyword">int</span> parentFieldColumn=attr.parentFieldColumn();<span class="comment">//父节点列号</span></span><br><span class="line">				<span class="keyword">if</span> (attr.isCombo()) &#123;  </span><br><span class="line">					<span class="keyword">if</span>(parentFieldColumn!=<span class="number">0</span>) &#123;</span><br><span class="line">						 <span class="comment">//联动</span></span><br><span class="line">						DataValidation data_validation = getDataValidationByFormula(xssfSheet,<span class="string">&quot;INDIRECT($&quot;</span>+getcellColumnFlag(parentFieldColumn)+(naturalRowIndex+<span class="number">1</span>)+<span class="string">&quot;)&quot;</span>,naturalRowIndex,col);</span><br><span class="line">						xssfSheet.addValidationData(data_validation);</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						DataValidation data_validation = getDataValidationByFormula(xssfSheet,field.getName(), naturalRowIndex, col);</span><br><span class="line">						xssfSheet.addValidationData(data_validation);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	 &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置数据验证"><a href="#设置数据验证" class="headerlink" title="设置数据验证"></a>设置数据验证</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(使用已定义的数据源方式设置一个数据验证)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> formulaString</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> row</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> col</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DataValidation <span class="title">getDataValidationByFormula</span><span class="params">(XSSFSheet xssfSheet,String formulaString,</span></span></span><br><span class="line"><span class="function"><span class="params">		<span class="keyword">int</span> row, <span class="keyword">int</span> col)</span> </span>&#123;</span><br><span class="line">	  <span class="comment">// 加载下拉列表内容</span></span><br><span class="line">	XSSFDataValidationHelper dvHelper = <span class="keyword">new</span> XSSFDataValidationHelper(xssfSheet);</span><br><span class="line">	XSSFDataValidationConstraint dvConstraint =(XSSFDataValidationConstraint) dvHelper.createFormulaListConstraint(formulaString);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置数据有效性加载在哪个单元格上。</span></span><br><span class="line">	<span class="comment">// 四个参数分别是：起始行、终止行、起始列、终止列</span></span><br><span class="line">	CellRangeAddressList regions = <span class="keyword">new</span> CellRangeAddressList(<span class="number">1</span>,<span class="number">65535</span>, col, col);</span><br><span class="line">	<span class="comment">// 数据有效性对象</span></span><br><span class="line">	XSSFDataValidation data_validation_list =(XSSFDataValidation) dvHelper.createValidation(dvConstraint, regions);</span><br><span class="line">	<span class="comment">//禁止手动填写 经测试 直接粘贴也可以</span></span><br><span class="line">	data_validation_list.setSuppressDropDownArrow(<span class="keyword">true</span>);</span><br><span class="line">	data_validation_list.setShowErrorBox(<span class="keyword">true</span>);</span><br><span class="line">	<span class="keyword">return</span> data_validation_list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(获取列名)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> num 下标</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getcellColumnFlag</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">	String columFiled = <span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">int</span> chuNum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> yuNum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (num &gt;= <span class="number">0</span> &amp;&amp; num &lt;= <span class="number">25</span>) &#123;</span><br><span class="line">		columFiled = doHandle(num);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		chuNum = (num / <span class="number">26</span>)-<span class="number">1</span>;</span><br><span class="line">		yuNum = num % <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line">		columFiled += doHandle(chuNum);</span><br><span class="line">		columFiled += doHandle(yuNum);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> columFiled;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">doHandle</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">	String[] charArr = &#123; <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>, <span class="string">&quot;I&quot;</span>, <span class="string">&quot;J&quot;</span>,</span><br><span class="line">			<span class="string">&quot;K&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&quot;N&quot;</span>, <span class="string">&quot;O&quot;</span>, <span class="string">&quot;P&quot;</span>, <span class="string">&quot;Q&quot;</span>, <span class="string">&quot;R&quot;</span>, <span class="string">&quot;S&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;U&quot;</span>, <span class="string">&quot;V&quot;</span>,</span><br><span class="line">			<span class="string">&quot;W&quot;</span>, <span class="string">&quot;X&quot;</span>, <span class="string">&quot;Y&quot;</span>, <span class="string">&quot;Z&quot;</span> &#125;;</span><br><span class="line">	<span class="keyword">return</span> charArr[num];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(添加表头批注)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> sheet</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> textlist</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> cell</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> XSSFSheet <span class="title">setXSSFPrompt</span><span class="params">(XSSFSheet sheet, String textlist, XSSFCell  cell)</span> </span>&#123;</span><br><span class="line">	 <span class="comment">// 创建HSSFPatriarch对象,HSSFPatriarch是所有注释的容器.</span></span><br><span class="line">	XSSFDrawing patr = sheet.createDrawingPatriarch();</span><br><span class="line">	<span class="comment">// 定义注释的大小和位置,详见文档</span></span><br><span class="line">	XSSFComment comment = patr.createCellComment(<span class="keyword">new</span> XSSFClientAnchor(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">short</span>)<span class="number">4</span>, <span class="number">2</span>, (<span class="keyword">short</span>) <span class="number">6</span>, <span class="number">5</span>));</span><br><span class="line">	<span class="comment">// 设置注释内容</span></span><br><span class="line">	comment.setString(<span class="keyword">new</span> XSSFRichTextString(textlist));</span><br><span class="line">	<span class="comment">// 设置注释作者. 当鼠标移动到单元格上是可以在状态栏中看到该内容.</span></span><br><span class="line">	cell.setCellComment(comment);<span class="comment">//添加注释</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> sheet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="反射操作类"><a href="#反射操作类" class="headerlink" title="反射操作类"></a>反射操作类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(利用反射动态修改注解)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> clazz 类</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> declareField 对象字段</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> memberKey 注解字段</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> memberValue 注解字段 对应的数据</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setClassExcelAnnotation</span><span class="params">(Class&lt;?&gt; clazz, String declareField, String memberKey, Object memberValue)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	Field declaredField = clazz.getDeclaredField(declareField);</span><br><span class="line">	declaredField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">	ExcelAnnotation annotation = declaredField.getAnnotation(ExcelAnnotation.class);</span><br><span class="line">	<span class="keyword">if</span> (annotation != <span class="keyword">null</span>) &#123;</span><br><span class="line">		InvocationHandler ih = Proxy.getInvocationHandler(annotation);</span><br><span class="line">		Field memberValuesField = ih.getClass().getDeclaredField(<span class="string">&quot;memberValues&quot;</span>);</span><br><span class="line">		memberValuesField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">		Map&lt;String, Object&gt; memberValues = (Map&lt;String, Object&gt;) memberValuesField.get(ih);</span><br><span class="line">		<span class="keyword">if</span>(memberValue <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">			<span class="comment">//参数本身就是字符串（prompt）</span></span><br><span class="line">			memberValues.put(memberKey, memberValue);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//数组/集合类型 需要转成json字符串</span></span><br><span class="line">			memberValues.put(memberKey, JSON.toJSONString(memberValue));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@Description</span>:TODO(通过反射的方式获取字段的值)</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> clazz 类</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> declareField 对象字段</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@param</span> list 下拉数据</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> *  <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String[] getClassFieldValueList(Class&lt;?&gt; clazz, String declareField, List&lt;?&gt; list) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	String[] strArray = <span class="keyword">new</span> String[list.size()];</span><br><span class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">		<span class="comment">//多个字段拼接</span></span><br><span class="line">		String declareFields[]=declareField.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">		String str =<span class="string">&quot;&quot;</span>;</span><br><span class="line">		Field declaredField;</span><br><span class="line">		<span class="keyword">for</span>(String fields:declareFields) &#123;</span><br><span class="line">			declaredField = clazz.getDeclaredField(fields);</span><br><span class="line">			declaredField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">			<span class="keyword">if</span>(str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">				str = declaredField.get(object).toString();</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				str += <span class="string">&quot;(&quot;</span>+declaredField.get(object).toString()+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		strArray[index++] = str;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> strArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="多选下拉"><a href="#多选下拉" class="headerlink" title="多选下拉"></a>多选下拉</h1><p>由于多选比较特殊，excel本身只支持单选的，但是我们可以利用‘宏’让Excel支持多选，所以需要先用宏设置好哪些列需要多选，然后导入预先设置好宏的excel模板，然后在它的基础上再实现其他功能即可。</p>
<h2 id="创建模板"><a href="#创建模板" class="headerlink" title="创建模板"></a>创建模板</h2><p>新建excel 然后打开‘宏’-&gt;创建宏-&gt;编辑代码</p>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Sub</span> Worksheet_Change(<span class="keyword">ByVal</span> Target <span class="keyword">As</span> Range)</span><br><span class="line"><span class="comment">&#x27;让数据有效性选择 可以多选,不可重复</span></span><br><span class="line"><span class="keyword">Dim</span> rngDV <span class="keyword">As</span> Range</span><br><span class="line"><span class="keyword">Dim</span> oldVal <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> newVal <span class="keyword">As</span> <span class="built_in">String</span></span><br><span class="line"><span class="keyword">If</span> Target.Count &gt; <span class="number">1</span> <span class="keyword">Then</span> <span class="keyword">GoTo</span> exitHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line"><span class="keyword">Set</span> rngDV = Cells.SpecialCells(xlCellTypeAllValidation)</span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">GoTo</span> exitHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> rngDV <span class="keyword">Is</span> <span class="literal">Nothing</span> <span class="keyword">Then</span> <span class="keyword">GoTo</span> exitHandler</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> Intersect(Target, rngDV) <span class="keyword">Is</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line"><span class="comment">&#x27;do nothing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line">Application.EnableEvents = <span class="literal">False</span></span><br><span class="line">newVal = Target.Value</span><br><span class="line"><span class="keyword">If</span> Target.Column = <span class="number">11</span> <span class="keyword">Or</span> Target.Column = <span class="number">12</span> <span class="keyword">Or</span> Target.Column = <span class="number">14</span> <span class="keyword">Then</span>  <span class="comment">&#x27;数字是你想要多选的列是多少，多个用or连接。</span></span><br><span class="line">Application.Undo</span><br><span class="line">oldVal = Target.Value</span><br><span class="line">Target.Value = newVal</span><br><span class="line"><span class="keyword">If</span> oldVal = <span class="string">&quot;&quot;</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Else</span></span><br><span class="line"><span class="keyword">If</span> newVal = <span class="string">&quot;&quot;</span> <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Else</span> <span class="comment">&#x27;去除重复的字段</span></span><br><span class="line">       <span class="keyword">If</span> InStr(<span class="number">1</span>, oldVal, newVal) &lt;&gt; <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">          <span class="keyword">If</span> InStr(<span class="number">1</span>, oldVal, newVal) + Len(newVal) - <span class="number">1</span> = Len(oldVal) <span class="keyword">Then</span> <span class="comment">&#x27;最后一个选项重复</span></span><br><span class="line">            Target.Value = Left(oldVal, Len(oldVal) - Len(newVal) - <span class="number">1</span>)</span><br><span class="line">          <span class="keyword">Else</span></span><br><span class="line">            Target.Value = Replace(oldVal, newVal &amp; <span class="string">&quot;,&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment">&#x27;不是最后一个选项重复的时候处理逗号</span></span><br><span class="line">          <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        <span class="keyword">Else</span> <span class="comment">&#x27;不是重复选项就视同增加选项</span></span><br><span class="line">Target.Value = oldVal _</span><br><span class="line">&amp; <span class="string">&quot;,&quot;</span> &amp; newVal <span class="comment">&#x27;可以是任意符号隔开</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">exitHandler:</span><br><span class="line">Application.EnableEvents = <span class="literal">True</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>

<h2 id="调用-导出模板"><a href="#调用-导出模板" class="headerlink" title="调用 导出模板"></a>调用 导出模板</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Map&lt;String,Object&gt;&gt;map=<span class="keyword">new</span> HashMap&lt;String, Map&lt;String,Object&gt;&gt;();</span><br><span class="line"><span class="comment">//下拉框数据</span></span><br><span class="line">Map&lt;String,Object&gt;param_chips=<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">List&lt;String&gt;chips=platformChipApproverMapper.selectChipToPdt();</span><br><span class="line">param_chips.put(<span class="string">&quot;comboValue&quot;</span>, chips);</span><br><span class="line">map.put(<span class="string">&quot;filechips&quot;</span>,param_chips);</span><br><span class="line"></span><br><span class="line"><span class="comment">//导入模板 (因为需要多选 所以要先导入一个已经设置好多选的excel模板)</span></span><br><span class="line">InputStream input = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(EXCEL_TEMPLATE));</span><br><span class="line">XSSFWorkbook workbook=<span class="keyword">new</span> XSSFWorkbook(input);</span><br><span class="line">ExcelUtil.getXSSFWorkbook(<span class="string">&quot;文档批量上传模板&quot;</span>,<span class="string">&quot;Sheet1&quot;</span>, FileExportVo.class, map, <span class="keyword">null</span>, workbook,response);</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">子晋</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.leezijin.com/20201111/excel-util/">http://blog.leezijin.com/20201111/excel-util/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.leezijin.com" target="_blank">子晋的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B7%A5%E5%85%B7%E7%B1%BB/">工具类</a><a class="post-meta__tags" href="/tags/excel/">excel</a></div><div class="post_share"><div class="social-share" data-image="/img/blog_excel-util.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/20201110/video-canvas/"><img class="next-cover" data-lazy-src="/img/blog_video-canvas.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">html5标签之video与canvas的使用</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="/img/author.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">子晋</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/onesuperman"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=bgHl-LHOLsaJLWpc7rC1tuMJ9-tNo2iY&amp;noverify=0" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:894610714@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.</span> <span class="toc-text">实现步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E6%9D%A5%E4%B8%AA%E9%85%8D%E7%BD%AE%E7%B1%BB%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.1.</span> <span class="toc-text">先来个配置类自定义注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Excel%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%85%A5%E5%8F%A3"><span class="toc-number">2.2.</span> <span class="toc-text">Excel工具类入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%8B%E6%8B%89%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">2.3.</span> <span class="toc-text">添加下拉数据验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE"><span class="toc-number">2.4.</span> <span class="toc-text">创建数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">2.5.</span> <span class="toc-text">设置数据验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E6%93%8D%E4%BD%9C%E7%B1%BB"><span class="toc-number">2.6.</span> <span class="toc-text">反射操作类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E9%80%89%E4%B8%8B%E6%8B%89"><span class="toc-number">3.</span> <span class="toc-text">多选下拉</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.1.</span> <span class="toc-text">创建模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E7%94%A8-%E5%AF%BC%E5%87%BA%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.2.</span> <span class="toc-text">调用 导出模板</span></a></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/20201111/excel-util/" title="工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）"><img data-lazy-src="/img/blog_excel-util.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）"/></a><div class="content"><a class="title" href="/20201111/excel-util/" title="工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）">工具类开发之excel模板导出（带单选下拉框、多选下拉框、单选下拉级联）</a><time datetime="2020-11-11T07:30:11.000Z" title="发表于 2020-11-11 15:30:11">2020-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20201110/video-canvas/" title="html5标签之video与canvas的使用"><img data-lazy-src="/img/blog_video-canvas.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="html5标签之video与canvas的使用"/></a><div class="content"><a class="title" href="/20201110/video-canvas/" title="html5标签之video与canvas的使用">html5标签之video与canvas的使用</a><time datetime="2020-11-10T10:23:40.000Z" title="发表于 2020-11-10 18:23:40">2020-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/20201109/first-word/" title="开篇"><img data-lazy-src="/img/blog_first-word.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="开篇"/></a><div class="content"><a class="title" href="/20201109/first-word/" title="开篇">开篇</a><time datetime="2020-11-09T09:15:50.000Z" title="发表于 2020-11-09 17:15:50">2020-11-09</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/blog_excel-util.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 By 子晋</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>function loadTwikoo () {
  function init () {
    twikoo.init({ 
      envId: 'leezijin-6grtq3fjceb1b01b' 
    })
  }

  if (typeof twikoo.init === 'function') {
    init()
  } else {
    $.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js', init)
  }
}

if ('Twikoo' === 'Twikoo' || !false) {
  if (false) btf.loadComment(document.getElementById('twikoo'), loadTwikoo)
  else loadTwikoo()
} else {
  function loadOtherComment () {
    loadTwikoo()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/8ff87b96.js","daovoice")
</script><script>var isChatBtn = true
daovoice('init', {
  app_id: '8ff87b96',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script></div></body></html>